# When Age-Invariant Face Recognition Meets Face Age Synthesis

## Abstract
为了尽可能降低年龄差异对人脸识别的影响，现有的方法主要分两种：
1. 通过最小化身份相关特征和年龄相关特征间的相关性，从而提取与身份相关的特征，称为年龄不变人脸识别(AIFR, age-invariant face recognition)
2. 通过将人脸表换到不同年龄组来去除年龄的影响，这种方法称为人脸年龄合成(FAS, face age synthesis)
但是第一种方法的模型解释缺少视觉结果，而第二种受生成影响较大。因此本文提出一个统一化的、多任务框架，用来同时处理这两个任务。称为MTLFace，它可以学习到年龄不变的身份特征表达同时给出效果较好的人脸生成结果。具体来说，首先通过一个注意力机制将人脸特征分解成两个无关联的部分：身份特征和年龄特征，然后使用多任务训练和连续域适应对这两部分进行去相关操作。

## 1. Introduction
在人脸识别领域中，如何最小化年龄差异带来的影响是一个重要问题。AIFR方法有3个困难：
1. 较大年龄差异会明显影响面部外观
2. 由于人脸外观随着时间的变化会发生较明显变化，而且不同人之间也存在差异，因此人脸年龄生成FAS是一个涉及到人脸增龄/减龄的复杂过程
3. 无法获取一个大的成对人脸数据集用来训练一个模型来渲染出自然效果的人脸同时保持身份特征

为了解决这3个困难，当前的AIFR方法可以粗略地分成两类：生成模型和判别模型。给定一张人脸图片，生成模型会将不同年龄的人脸变换到同一个年龄组中来辅助人脸识别。通常会用one-hot编码来代指目标年龄组。但是one-hot编码虽然代表了年龄组的信息，却忽视掉身份层面的信息。也就是说，这种方法由于合成效果较差，而且身份信息丢失的原因，导致无法提高识别性能。另一方面，判别模型通过将身份信息从混合信息中提取出来从而专注于提取年龄无关的特征向量。虽然这种方法在AIFR中的效果较好，但是无法提供人脸可视化。
为了进一步提升生成模型的质量，并且为判别模型提供更强的解释能力，提出一个统一化的多任务学习框架，同时实现AIFR和FAS的功能，称为MTLFace

## 2. Related Work
...
![Figure 2](2.png 'Figure 2')
## 3. Method
Figure 2展示了MTLFace的主要架构
### 3.1. Attention-based Feature Decomposition
因为人脸随时间的变化很大，因此AIFR的主要问题便在于年龄的变化通常会增加类内距离。所以识别同一个人的两张来自不同年龄段人脸图像较为困难，原因在于人脸表示通常混合了很多（与身份）无关的信息，例如面部形状和纹理的变化等。有一种方法通过线性分解模块将人脸特征向量分解成两个无关的部分，对应年龄向量和身份向量。但是这种方法有两个主要缺点：
1. 分解得到的身份部分缺少面部空间的信息，不适合FAS
2. 这个分解过程没有约束，可能导致训练的不稳定

为了解决这些问题，提出使用一种注意力机制在一个高阶语义空间将混合的特征图进行分解，称为基于注意力的特征分解(AFD, attention-based feature decomposition). 这样做的主要原因是操控特征向量和操控特征图相比要复杂得多，因为年龄变化的影响会导致在语义空间中发生变化但是特征却不变。我们使用一个ResNet类backbone作为编码器E从输入图像I中提取混合特征图$X\in \mathbb{R}^{C\times H' \times W'}$, i.e. X=E(I), AFD可以定义为：
$$
X=X \circ \sigma(X)+X\circ (1-\sigma(X))
$$
第一项是$X_{age}$，第二项是$X_{id}$，其中$\circ$代表元素级乘法，$\sigma$代表注意力模块。这样，就可以用注意力模块从特征图中将与年龄相关的信息分离出来，而注意力模块是通过一个年龄估计的任务进行监督的，对应剩余的部分则可视为身份相关的信息，可以通过人脸识别任务进行监督。结果就是，注意力机制对分解模块进行了约束，这要比在特征图中检测与年龄相关的特征要好。注意到由于只受两个对应任务的驱动，这里假设X只包含年龄和身份信息，而其他的信息，例如对FAS很重要的背景信息，则是由编码器和解码器之间的跳跃链接提供的。Figure 2(b)中展示了AFD的详细结构。
这里我们采用了通道注意力和空间注意力的平均，同时在通道和空间层面对年龄信息进行强调。注意到这两个注意力模块的输出尺寸不一样，所以先将他们拉伸到原始的输入尺寸，然后进行平均。

### 3.2. Identity Conditional Module
![Figure 3](3.png 'Figure 3')
由于在小范围内年龄所造成的差异很小，因此主流的人脸年龄研究都把年龄分成了几个不重叠的年龄段。它们一般使用一个one-hot编码来明确目标年龄段，从而控制年龄变化过程，如Figure 3(a)所示。由于使用这种one-hot编码作为年龄条件来学习，每个年龄段会学到对应的年龄段层级的年龄变化模式，例如30岁时长胡子这种特征。这个方法有两方面缺陷：
1. one-hot编码表明了年龄段级别的年龄变换模式而忽略了不同人之间的差异，尤其是不同性别和人种间的差异
2. one-hot编码可能无法保证生成人脸的年龄平滑性质

为了解决one-hot编码引起的这些问题，提出一个身份条件模块(ICB, identity conditional block)用于获取身份层面上的年龄变化模式，同时采用共享权重策略来提升合成人脸的年龄平滑性。具体来说，ICB将AFD的身份相关特征作为输入，来学习一个身份层面上的年龄变化模式。然后提出一个权重共享策略来提升合成人脸的年龄平滑性，这样一部分卷积核会在相邻的年龄段间共享参数，如Figure 3(b)所示。这样做的原因是，人脸随时间是逐渐变化的，使用共享的卷积核可以学习到一些相邻年龄段间通用的年龄变化模式。需要注意使用$1\times 1$的卷积将$X_{id}$的维度从512降到128从而降低计算成本。使用一个超参数s来控制相邻年龄段共享多少比例的卷积核，默认设置为1/8，